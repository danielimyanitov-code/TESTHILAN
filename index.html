<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>מחשבון השכר של דניאל</title>
  <meta name="description" content="מחשבון שכר חילן - העלה דוח נוכחות PDF לחישוב שכר אוטומטי">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- חלונית סיסמא -->
  <div id="passwordModal" class="password-modal">
    <div class="password-content">
      <h2>🔐 הזנת סיסמא</h2>
      <p>נדרשת סיסמא לשימוש במחשבון השכר</p>
      <form id="passwordForm" novalidate>
        <div class="password-input-group">
          <input 
            type="password" 
            id="passwordInput" 
            name="password"
            placeholder="הזן סיסמא..." 
            autocomplete="current-password"
            required
            aria-label="הזנת סיסמא למערכת">
          <button type="submit" id="passwordSubmit" class="btn btn-primary">כניסה</button>
        </div>
      </form>
      <div id="passwordError" class="password-error" role="alert" aria-live="polite"></div>
      <div style="margin-top: 20px; font-size: 12px; color: var(--muted);">
        💡 פנה לדניאל לקבלת הסיסמא
      </div>
    </div>
  </div>

  <div class="page" id="mainContent" style="display: none;">
    <header class="site-header">
      <div class="container">
        <div class="brand">
          <div class="logo">ח</div>
          <div class="titles">
            <h1>מחשבון שכר חילן</h1>
            <p class="subtitle">העלה דוח נוכחות PDF לחישוב שכר אוטומטי</p>
          </div>
        </div>
        <div class="header-actions">
          <button id="btnDarkMode" class="btn btn-ghost">🌙 מצב כהה</button>
        </div>
      </div>
    </header>

    <main class="container">
      <div class="main-grid">
        <!-- פאנל העלאה -->
        <div class="card upload-panel">
          <header class="card-header">
            <h3>📂 העלאת דוח נוכחות</h3>
            <p class="muted">גרור קובץ PDF או לחץ לבחירה</p>
          </header>
          
          <div class="upload-zone" id="uploadZone" tabindex="0" role="button" aria-label="העלאת קובץ PDF">
            <div class="upload-illustration">
              <div class="icon">📄</div>
              <div class="hint">
                <span class="link">לחץ לבחירת קובץ</span> או גרור לכאן
              </div>
              <div class="small muted">קבצי PDF בלבד • מקסימום 10MB</div>
            </div>
            <input type="file" id="fileInput" class="file-input" accept=".pdf,application/pdf" aria-label="בחירת קובץ PDF">
          </div>

          <div class="status-panel" id="statusPanel">
            <div class="status" id="statusProcessing">
              <div class="spinner"></div>
              <span id="statusText">מעבד קובץ...</span>
            </div>
            <div class="status" id="statusSuccess">
              <div class="dot ok"></div>
              <span id="successText">הקובץ עובד בהצלחה</span>
            </div>
            <div class="status" id="statusError">
              <div class="dot err"></div>
              <span id="errorText">שגיאה בעיבוד הקובץ</span>
            </div>
          </div>

          <div class="tips">
            <div class="tip">
              <strong>💡 טיפ:</strong> המערכת תומכת בשני סוגי קבצים:
              <ul style="margin: 8px 0 0 20px; padding: 0;">
                <li><strong>תלוש שכר</strong> - מזהה אוטומטית את הסכומים והשעות</li>
                <li><strong>דוח נוכחות</strong> - קורא את השורות התחתונות עם קודי חילן</li>
              </ul>
              <div style="margin-top: 8px; font-size: 12px; color: var(--muted);">
                ⚡ <strong>מומלץ:</strong> העלה את התלוש שכר לדיוק מקסימלי!
              </div>
            </div>
          </div>
        </div>

        <!-- פאנל החישוב -->
        <div class="card calculator-panel">
          <header class="card-header space-between">
            <h3>🧮 חישוב שכר</h3>
            <div class="field">
              <label class="label">תעריף בסיס (₪/שעה)</label>
              <div class="input-affix">
                <input type="number" id="baseRate" value="61.45" step="0.01" min="0" aria-label="תעריף בסיס בשקלים לשעה">
                <div class="affix">₪/שעה</div>
              </div>
            </div>
          </header>

          <div class="table-wrap">
            <table class="data-table" role="table" aria-label="טבלת חישוב שכר">
              <thead>
                <tr>
                  <th scope="col">סוג משמרת</th>
                  <th scope="col">אחוז</th>
                  <th scope="col">תעריף</th>
                  <th scope="col">שעות</th>
                  <th scope="col">סכום</th>
                </tr>
              </thead>
              <tbody id="salaryTableBody">
                <!-- יתמלא דינמית -->
              </tbody>
            </table>
          </div>

          <div class="card-section">
            <h4>💰 תוספות</h4>
            <div class="grid-3">
              <div class="field">
                <label class="label" for="vacationDays">ימי חופש</label>
                <input type="number" id="vacationDays" value="0" step="1" min="0" class="hours-input" aria-label="מספר ימי חופש">
              </div>
              <div class="field">
                <label class="label" for="travelAmount">נסיעות (₪)</label>
                <input type="number" id="travelAmount" value="700" step="50" min="0" class="hours-input" aria-label="סכום נסיעות בשקלים">
              </div>
              <div class="field">
                <label class="label" for="mealDays">ימי אשל</label>
                <input type="number" id="mealDays" value="0" step="1" min="0" class="hours-input" aria-label="מספר ימי אשל">
              </div>
            </div>
            <div style="margin-top: 12px; padding: 10px; background: linear-gradient(180deg, rgba(59,130,246,.08), rgba(59,130,246,.04)); border-radius: 8px; font-size: 13px; color: var(--muted); border: 1px solid rgba(59,130,246,.2);">
              💡 <strong>טיפ להזנת שעות:</strong> ניתן להזין זמן כמו <code style="background: rgba(255,255,255,.1); padding: 2px 6px; border-radius: 4px;">8.22</code> (8 שעות ו-22 דקות) והמערכת תמיר אוטומטית ל-<code style="background: rgba(255,255,255,.1); padding: 2px 6px; border-radius: 4px;">8.37</code> שעות עשרוניות
            </div>
          </div>

          <div class="summary">
            <div class="card-section">
              <div class="summary-row">
                <div>
                  <div class="summary-label">סה"כ שכר</div>
                  <div class="summary-sub"><span id="totalHours">0</span> שעות | לפני ניכויים</div>
                </div>
                <div class="summary-amount" id="totalSalary" aria-label="סכום כולל">₪0</div>
              </div>
            </div>
          </div>

          <!-- תצוגה מקדימה של הדוח -->
          <div class="card-section" id="previewSection" style="display: none;">
            <h4>📋 תצוגה מקדימה לדוח</h4>
            <div class="preview-content">
              <div class="preview-header">
                <strong>שורת הסה"כ לדוח חילן:</strong>
              </div>
              <div class="preview-data" id="previewData">
                <!-- יתמלא דינמית -->
              </div>
              <button class="btn btn-secondary" onclick="copyPreviewData()" aria-label="העתק נתוני תצוגה מקדימה">
                📋 העתק שורת סה"כ
              </button>
            </div>
          </div>

          <div class="actions">
            <button id="btnClear" class="btn btn-secondary" aria-label="נקה את כל הנתונים">
              🧹 נקה נתונים
            </button>
            <button id="btnExport" class="btn btn-primary" aria-label="ייצא נתונים לקובץ אקסל">
              📊 ייצא לאקסל
            </button>
          </div>
        </div>
      </div>
    </main>

    <footer class="site-footer">
      <div class="container">
        <div class="footer-grid">
          <div class="foot-note">
            © <span id="y">2025</span> נוצר על ידי דניאל • אין אני נושא באחריות לכל שימוש או נזק שייגרם כתוצאה מהשימוש בכלי זה
          </div>
        </div>
      </div>
    </footer>
  </div>

  <script src="js/script.js"></script>
</body>
</html>
